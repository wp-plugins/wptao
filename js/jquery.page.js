/* v1.3 http://blogqun.com/wptao.html */
jQuery(function(a){wptao_data||(wptao_data={title:"post_title",url:"tbk_link",item_click:"tbk_mm_link",shop_click:"shop_url",price:"tbk_price",old_price:"tbk_old_price",image:"imageURL",desc:"post_content",shop_name:"shop_name",postfee:"tbk_postfee",tags:"tbk_tag",id:"tbk_id",mall:"tbk_mall",site:"tbk_site",preview:"wptao_preview"});var b=wptao_data.preview;a("#get_item_info").click(function(){if(!wptao_js.login)return alert("请登录后再操作！"),!1;var c=a("#tbk_link").val();return c?(a("input[type='text'],input[type='hidden'],textarea").val(""),a("#tbk_link").val(c),a("#wptao_tips").html(""),a.ajax({type:"GET",url:wptao_js.plugin_url+"/get_items.php?type=sign&link="+encodeURIComponent(c),success:function(d){if(!d)return alert("请填写插件授权码！"),!1;var e=wptao_js.api+"/get_items_detail.php?callback=?";a.getJSON(e,{u:encodeURIComponent(c),from:encodeURIComponent(wptao_js.blog_url),sign:d,c:"p",cps:wptao_data.item_click||wptao_data.shop_click?1:0,desc:wptao_data.desc?1:0,v:wptao_js.v},function(c){var d,e;if(c.error)alert(c.error);else if(c.url){c.tips&&a("#wptao_tips").html(c.tips);for(d in wptao_data)c[d]&&a("#"+wptao_data[d]).val(c[d]);b&&a("#"+b).length>0&&(e="",c.image&&(e='<img src="'+c.image+'" />'),a("#"+b).html(e)),a("#tax_input option").length>0&&(a("#tax_input option[value='']").attr("selected",!0),a("#tax_input option").each(function(){return a(this).text().indexOf(c.site)>=0?(a(this).attr("selected",!0),!1):void 0}))}})}}),void 0):(alert("商品链接不能留空！"),!1)}),b&&a("#"+b).length>0&&wptao_data.image&&a("#"+wptao_data.image).each(function(){a(this).bind("mouseleave change focus blur",function(){var c="",d=a(this).val();d&&(c='<img src="'+d+'" />'),a("#"+b).html(c)})})});